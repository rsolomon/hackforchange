<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Stylesheets -->
    <link rel="stylesheet" href="lib/bootstrap/css/bootstrap.css" />
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <div class="container">
      <div id="signup-view" class="row signup-prompt hide">
        <div class="span6">
          <img src="img/co2-100.png"/><h1>Carbonizr</h1>
          <form id="login" class="form-vertical well">
            <fieldset>
              <legend>Log-in</legend>
              <div class="control-group">
                <input type="text" name="email" class="span5" placeholder="Email"><br/>
                <input type="password" name="password" class="span5" placeholder="Password"><br/>
                <button type="submit" class="btn btn-primary">Login</button>
              </div>
            </fieldset>
          </form>
        </div>
        <div class="span6">
          <form id="signup" class="form-vertical well">
            <fieldset>
              <legend>Sign up</legend>
              <div class="control-group">
                <input type="text" name="name" class="span5" placeholder="Your Name"><br/>
                <input type="text" name="email" class="span5" placeholder="Email"><br/>
                <input type="password" name="password" class="span5" placeholder="Password"><br/>
                <button type="submit" class="btn btn-primary">Login</button>
                <br/>
                <br/>
                <h5>Or</h5>
                Do OAuth
              </div>
            </fieldset>
          </form>
        </div>
      </div>
      <div id="carbonizer" class="hide">
        App
      </div>
  </div>

    <!-- javascript -->
    <script src="http://code.jquery.com/jquery-1.7.2.js"></script>
    <script src="lib/jquerypp/jquerypp.js"></script>
    <script src="lib/underscore/underscore.js"></script>
    <script src="lib/backbone/backbone.js"></script>
    <script src="lib/bootstrap/js/bootstrap.js"></script>
    <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.0.12.min.js"></script>
    <script src="js/common/namespace.js"></script>
    <script src="js/collection/base_amee.js"></script>
    <script src="js/collection/flight_emission.js"></script>
    <script src="js/collection/flight.js"></script>
    <script>
      $(function() {
        'use strict'
        co2.view.AppView = Backbone.View.extend({
          el: "#carbonizer",

          initialize: function() {
            this.render();
          },

          render: function() {
            this.$el.show();
          }
        });
        co2.view.SignupView = Backbone.View.extend({
          el: "#signup-view",

          signupForm: $("#signup"),
          loginForm: $("#login"),

          events: {
            "submit #login": "login",
            "submit #signup": "signup",
          },

          initialize: function() {
            this.render();
          },

          render: function() {
            this.$el.show();
          },

          login: function() {
            var loginData =  this.loginForm.formParams();
            Parse.User.logIn(loginData.email, loginData.password, {
              success: function(user) {
                console.log("success");
              },
              error: function(user, error) {
                console.log("error " + error);
              }
            });
            return false;
          },

          signup: function() {
            var signupData = this.signupForm.formParams(),
              user = new Parse.User();
            signupData.username = signupData.email;
            user.set(signupData);
            user.signUp(null, {
              success: function(user) {
                console.dir(user);
              },
              error: function(user, error) {
                console.dir(user);
                console.dir(error);
              }
            });
            return false;
          }
        });
        //Parse.User.logOut();
        if (Parse.User.current()) {
          new co2.view.AppView();
        } else {
          new co2.view.SignupView();
        }
      });
    </script>
  </body>
</html>
